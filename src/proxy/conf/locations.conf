
  location = /favicon.ico {
    log_not_found off;
  }
######################
###  STATIC ASSETS ###
######################
################################################################################
### STYLES
# The ngx_http_gzip_static_module module allows sending
# precompressed files with the “.gz”
# filename extension instead of regular files.
################################################################################
  location ~* /styles/.+ {
    rewrite "^/styles/(\w+)([?\.]{1}\w+)?$" /styles/$1.css break;
    more_set_headers  "Content-Type: text/css; charset=utf-8";
    more_set_headers  "X-Content-Type-Options: nosniff";
    add_header Strict-Transport-Security max-age=15768000;
    add_header Vary Accept-Encoding;
    expires max;
    gzip off;
    gzip_static  always;
    gunzip on;
    root html/$domain;
  }

### SCRIPTS
############

  location ~* /scripts/.+ {
    rewrite "^/scripts/(\w+)([?\.]{1}\w+)?$" /scripts/$1.js break;
    more_set_headers  "Content-Type: application/javascript; charset=utf-8";
    more_set_headers  "Cache-Control: public,max-age=31536000,immutable";
    more_set_headers  "X-Content-Type-Options: nosniff";

# add_header Strict-Transport-Security max-age=15768000;
    add_header Vary Accept-Encoding;
    expires max;
    gzip off;
    gzip_static  always;
    gunzip on;
    root html/$domain;
  }

################################################################################
# ICONS
# anything in the icons dir is served as image/svg+xml
# resource is a gzipped svg so has extension svgz
# url does(should) not need an extension so rewrite creates one (always svgz)
# even if request is for svg
###############################################################################

  location ~* /icons/.+ {
    rewrite "^/icons/(\w+)([?\.]{1}\w+)?$" /icons/$1.svgz break;
    more_set_headers  "Content-Type: image/svg+xml; charset=utf-8";
    more_set_headers  "Cache-Control: public,max-age=31536000,immutable";
    more_set_headers  "X-Content-Type-Options: nosniff";
# add_header Strict-Transport-Security max-age=15768000;
    add_header Vary Accept-Encoding;
    add_header Content-Encoding gzip;
    expires max;
    root /opt/proxy/html;
# log_not_found off;
  }

###############################################################################
# IMAGES TODO
# look for images on disk,
# images don't have to have an extension ref. try files
# don't bother to gzip or look for gzip file
# make *browser cache* images with expires set to max into the future
# nginx declaration 'expires max' sets both expires and cache-control headers
# nginx sets 'etag on' automatically, setting both etag and last-modified
###############################################################################

  location ~* ^/(index|index.html)?$ {
    default_type  "text/html; charset=utf-8";
    rewrite ^/?(.*)$ /$domain/home/index break;
    proxy_pass http://xq;
  }


  location / {
    rewrite ^/?(.*)$ /$domain/$1 break; 
    proxy_pass http://xq;
  }

